---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

labels:
  - pairs:
      app.kubernetes.io/part-of: immich
      app.kubernetes.io/managed-by: kustomize
    includeTemplates: true

namespace: immich
resources:
  - namespace.yml
  - pv.yml
  - immich-server
  - immich-machine-learning
  - redis
  - postgres
  - ingress.yml

images:
  - name: immich-server
    newName: ghcr.io/immich-app/immich-server
    newTag: v2.3.1
  - name: immich-machine-learning
    newName: ghcr.io/immich-app/immich-machine-learning
    newTag: v2.3.1
  - name: redis
    newName: docker.io/valkey/valkey
    newTag: 8@sha256:81db6d39e1bba3b3ff32bd3a1b19a6d69690f94a3954ec131277b9a26b95b3aa
  - name: postgres
    newName: ghcr.io/immich-app/postgres
    newTag: 14-vectorchord0.4.3-pgvectors0.2.0@sha256:bcf63357191b76a916ae5eb93464d65c07511da41e3bf7a8416db519b40b1c23

configMapGenerator:
  - name: immich-server-config
    files:
      - immich.json

secretGenerator:
  - name: immich-server-credentials
    options:
      disableNameSuffixHash: true
    envs:
      - immich-database-credentials.env
  - name: immich-ml-credentials
    options:
      disableNameSuffixHash: true
    envs:
      - immich-database-credentials.env
  - name: postgres-credentials
    options:
      disableNameSuffixHash: true
    envs:
      - immich-database-credentials.env
